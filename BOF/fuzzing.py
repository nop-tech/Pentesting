import socket
import sys
import time


def main(argv):
    ip = argv[0]
    port = int(argv[1])
    prefix = argv[2]
    timeout = 5

    string = prefix + 'A' * 100

    while True:
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                s.settimeout(timeout)
                s.connect((ip, port))
                s.recv(1024)
                print('Fuzzing with {} bytes'.format(len(string) - len(prefix)))
                s.send(bytes(string, 'UTF-8'))
                s.recv(1024)
        except:
            print('Fuzzing crashed at {} bytes'.format(len(string) - len(prefix)))
            sys.exit(0)
        string += 'A' * 100
        time.sleep(1)


def usage():
    print('Usage: python3 fuzzing.py <IP> <PORT> <PREFIX>')
    sys.exit(1)


if len(sys.argv) != 4:
    usage()

if __name__ == '__main__':
    main(sys.argv[1:])
