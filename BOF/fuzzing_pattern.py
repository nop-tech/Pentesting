import socket
import sys
import os


def main(argv):
    ip = argv[0]
    port = int(argv[1])
    prefix = argv[2]
    timeout = 5

    if not os.path.isfile('pattern.txt'):
        print('Place "pattern.txt" in the same directory as this python script')
        sys.exit(1)

    with open('pattern.txt') as f:
        offset = f.read()

    string = prefix + offset

    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.settimeout(timeout)
            s.connect((ip, port))
            s.send(bytes(string, 'UTF-8'))
            s.recv(1024)
    except:
        print('Something went wrong')
        sys.exit(0)


def usage():
    print('Usage: python3 fuzzing.py <IP> <PORT> <PREFIX>')
    sys.exit(1)


if len(sys.argv) != 4:
    usage()

if __name__ == '__main__':
    main(sys.argv[1:])
